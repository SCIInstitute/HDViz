PROJECT(Server)

# For Server
FIND_PACKAGE(Threads)
FIND_PACKAGE(ZLIB REQUIRED)

CMAKE_POLICY(SET CMP0042 OLD)


# For Bakend
FIND_PACKAGE(PNG)
FIND_PACKAGE(JPEG)

SET(SERVER_INCLUDE_FILES 
  dsxdyn.h)

SET(SERVER_SOURCE_FILES 
  dSpaceX.cpp
  dsxdyn.c
  render.c)

SET(SAMPLE_BACKEND_SOURCE_FILES
  sampleBE.c
  thumbs.c)


INCLUDE_DIRECTORIES(../include)
IF(APPLE)
  INCLUDE_DIRECTORIES("/usr/local/include")
endif(APPLE)


ADD_EXECUTABLE(dSpaceX ${SERVER_INCLUDE_FILES} ${SERVER_SOURCE_FILES} ${ZLIB_INCLUDE_DIRS}) 
TARGET_LINK_LIBRARIES (dSpaceX libwsserver pthread dl ${ZLIB_LIBRARIES})

# ADD_LIBRARY(sampleBE SHARED ${SAMPLE_BACKEND_SOURCE_FILES} ${PNG_LIBRARY} ${JPEG_LIBRARY} ${JPEG_INCLUDE_DIR})
add_library(sampleBE MODULE ${SAMPLE_BACKEND_SOURCE_FILES} ${PNG_LIBRARY} ${JPEG_LIBRARY} ${JPEG_INCLUDE_DIR})
SET_TARGET_PROPERTIES(sampleBE PROPERTIES BUNDLE TRUE)
SET_TARGET_PROPERTIES(sampleBE PROPERTIES LINK_FLAGS "-undefined dynamic_lookup" SUFFIX ".so")